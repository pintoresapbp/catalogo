<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Catálogo de Produtos</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Inter', sans-serif;
  background: #ffffff;
  margin: 0;
  padding: 40px 60px;
  color: #2B2B2B;
}

h1 {
  font-family: 'Playfair Display', serif;
  text-align: center;
  margin-bottom: 10px;
}

.filtros {
  text-align: center;
  margin: 30px 0 50px;
}

.filtros h4 {
  margin: 15px 0 8px;
  font-weight: 400;
  color: #6F6F6F;
}

.filtro-btn {
  border: 1px solid #ddd;
  background: transparent;
  padding: 6px 14px;
  margin: 4px;
  border-radius: 20px;
  cursor: pointer;
  font-size: 13px;
}

.filtro-btn.ativo {
  background: #EAE8E3;
  border-color: #EAE8E3;
}

.secao {
  margin-bottom: 70px;
}

.secao h2 {
  font-family: 'Playfair Display', serif;
  font-size: 22px;
  margin-bottom: 25px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 35px;
}

.card {
  text-align: center;
}

.card img {
  width: 100%;
  height: 200px;
  object-fit: contain;
  cursor: pointer;
}

.nome {
  margin-top: 10px;
  font-size: 13px;
  font-weight: 500;
}

.valor {
  font-size: 13px;
  color: #3E6B5B;
  margin-top: 3px;
}

/* MODAL */
.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  justify-content: center;
  align-items: center;
  z-index: 10;
}

.modal img {
  max-width: 65%;
  max-height: 70vh;
  width: auto;
  height: auto;
  image-rendering: auto;
}

.modal .legenda {
  margin-top: 15px;
  text-align: center;
  color: #fff;
  font-size: 14px;
  font-family: 'Playfair Display', serif;
  opacity: 0.9;
}

@media (max-width: 768px) {
  body {
    padding: 25px;
  }
}

/* =========================
   MOBILE (até 768px)
========================= */
@media (max-width: 768px) {

  body {
    padding: 0 16px;
  }

  h1 {
    font-size: 28px;
    text-align: center;
  }

  h2 {
    font-size: 22px;
    margin-bottom: 16px;
  }

  /* Filtros */
  .filtros,
  .campanhas,
  .tipos {
    display: flex;
    overflow-x: auto;
    gap: 10px;
    padding-bottom: 8px;
    justify-content: flex-start;
  }

  .filtros::-webkit-scrollbar {
    display: none;
  }

  .filtro-btn {
    flex: 0 0 auto;
    white-space: nowrap;
    font-size: 14px;
    padding: 8px 14px;
  }

  /* Grid de produtos */
  .grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
    justify-content: center;
  }

  /* Cards */
  .card {
    width: 100%;
  }

  .card img {
    width: 100%;
    height: auto;
  }

  .card h3 {
    font-size: 14px;
    line-height: 1.3;
  }

  .card p {
    font-size: 13px;
  }

  /* Seções */
  .secao {
    margin-bottom: 70px;
  }

  /* Modal */
  .modal {
    padding: 16px;
  }

  .modal-content {
    width: 100%;
    max-width: 100%;
  }

  .modal img {
    max-width: 100%;
    transform: scale(0.65); /* mantém sua decisão */
  }

}
  
</style>
</head>

<body>

<h1>Catálogo de Produtos</h1>

<div class="filtros">
  <h4>Campanhas</h4>
  <div id="filtroCampanha"></div>

  <h4>Tipos</h4>
  <div id="filtroTipo"></div>
</div>

<div id="catalogo"></div>

<div class="modal" id="modal">
  <div>
    <img id="modalImg">
    <div class="legenda" id="modalLegenda"></div>
  </div>
</div>

<script>
const SHEET_ID = "1dHq0xUfn0bv9PeMDGCEk4XpKpy3jYmrqb11xZNi7rso";
const SHEET_NAME = "Sheet1";
const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${SHEET_NAME}`;

let dados = {};
let campanhaAtiva = "";
let tipoAtivo = "";

fetch(URL)
  .then(r => r.text())
  .then(t => {
    const json = JSON.parse(t.substring(47).slice(0, -2));
    json.table.rows.forEach(r => {
      const campanha = r.c[0]?.v;
      const tipo = r.c[1]?.v;
      const sku = r.c[2]?.v;
      const produto = r.c[3]?.v;
      const estoque = Number(r.c[4]?.v || 0);
      const valor = Number(r.c[5]?.v || 0);
      const imagem = r.c[6]?.v;

      if (estoque <= 0) return;

      dados[campanha] ??= {};
      dados[campanha][tipo] ??= [];
      dados[campanha][tipo].push({ sku, produto, valor, imagem });
    });

    campanhaAtiva = Object.keys(dados)[0];
    renderFiltros();
    renderCatalogo();
  });

function renderFiltros() {
  const fc = document.getElementById("filtroCampanha");
  const ft = document.getElementById("filtroTipo");
  fc.innerHTML = ft.innerHTML = "";

  Object.keys(dados).forEach(c => {
    const b = document.createElement("button");
    b.className = "filtro-btn" + (c === campanhaAtiva ? " ativo" : "");
    b.innerText = c;
    b.onclick = () => {
      campanhaAtiva = c;
      tipoAtivo = "";
      renderFiltros();
      renderCatalogo();
    };
    fc.appendChild(b);
  });

  Object.keys(dados[campanhaAtiva]).forEach(t => {
    const b = document.createElement("button");
    b.className = "filtro-btn" + (t === tipoAtivo ? " ativo" : "");
    b.innerText = t;
    b.onclick = () => {
      tipoAtivo = t;
      renderFiltros();
      renderCatalogo();
    };
    ft.appendChild(b);
  });
}

function renderCatalogo() {
  const c = document.getElementById("catalogo");
  c.innerHTML = "";

  Object.keys(dados[campanhaAtiva]).forEach(tipo => {
    if (tipoAtivo && tipo !== tipoAtivo) return;

    const sec = document.createElement("div");
    sec.className = "secao";
    sec.innerHTML = `<h2>${tipo}</h2><div class="grid"></div>`;

    const grid = sec.querySelector(".grid");

    dados[campanhaAtiva][tipo].forEach(i => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <img src="${i.imagem}" onclick="abrirModal('${i.imagem}','${i.sku} • ${i.produto}')">
        <div class="nome">${i.sku} • ${i.produto}</div>
        <div class="valor">R$ ${i.valor.toFixed(2).replace('.', ',')}</div>
      `;
      grid.appendChild(card);
    });

    c.appendChild(sec);
  });
}

function abrirModal(img, texto) {
  document.getElementById("modalImg").src = img;
  document.getElementById("modalLegenda").innerText = texto;
  document.getElementById("modal").style.display = "flex";
}

document.getElementById("modal").onclick = () =>
  document.getElementById("modal").style.display = "none";
</script>

</body>
</html>
